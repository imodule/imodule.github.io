<!DOCTYPE html>
<html>

<head>
	<title>Widget Content</title>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<link rel="stylesheet" type="text/css" href="/assets/css/base-form.css">
</head>

<body>
	<div class="container" id="app">
		<div class="contact">

			<form name="contact-form" ref="contact-form">

				<div class="field-header">
					<div class="field-image"></div>
					<div class="field-title">Sign up</div>
					<div class="field-subtitle">Join the community</div>
				</div>

				<div class="field">
					<div class="input-wrapper">
						<input type="text" name="iname" id="iname" data-rule="required|name" autocomplete="off">
						<label class="placeholder" for="iname">Your name</label>
					</div>
				</div>

				<div class="field">
					<div class="input-wrapper">
						<input type="text" name="iemail" id="iemail" data-rule="required|email" autocomplete="off">
						<label class="placeholder" for="iemail">E-mail</label>
					</div>
				</div>

				<div class="field">
					<div class="input-wrapper">
						<input type="text" name="iphone" id="iphone" data-rule="required|length-10-10" autocomplete="off">
						<label class="placeholder" for="iphone">Phone</label>
					</div>
				</div>

				<div class="field">
					<div class="input-wrapper">
						<textarea id="imessage" name="imessage" data-rule="required|minlength-6" autocomplete="off"></textarea>
						<label class="placeholder" for="imessage">Your Message</label>
					</div>
				</div>

				<div class="field">
					<input type="submit" value="Create account">
				</div>
			</form>

		</div>

		<script>
			var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.arrayIteratorImpl = function (a) { var b = 0; return function () { return b < a.length ? { done: !1, value: a[b++] } : { done: !0 } } }; $jscomp.arrayIterator = function (a) { return { next: $jscomp.arrayIteratorImpl(a) } }; $jscomp.makeIterator = function (a) { var b = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator]; return b ? b.call(a) : $jscomp.arrayIterator(a) };
			function loadScript(a, b) { var c = document.createElement("script"); c.type = "text/javascript"; c.src = a; c.onreadystatechange = b; c.onload = b; document.head.appendChild(c) } function loadScripts(a, b) { for (var c = arguments, g = this, e = 0, h = function () { e++; e >= a.length && b.call(g, c) }, f = $jscomp.makeIterator(a), d = f.next(); !d.done; d = f.next())loadScript(d.value, h) };
		</script>
		<script>
			// data
			var record = {};
			// event
			var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
			var eventer = window[eventMethod];
			var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
			eventer(messageEvent, function (e) {
				console.log('-- Child :  ', e.data);
				if (window.EventBus) {
					window.EventBus.$emit('data', e.data);
				}
				else {
					record = e.data;
				}

			}, false);

			// init
			window.loadScripts(["/assets/js/vue.min.js", "/assets/js/form/main.min.js"], function () {
				console.log('Init')
				init()
			});

			function init() {
				window.EventBus = new Vue();

				var app = new Vue({
					el: '#app',
					data: {
						record: record,
					},
					watch: {
						record: function (val) {
							this.changeValid();
						},
					},
					mounted: function () {
						this.getData();
						this.changeValid();
					},
					methods: {
						getData: function () {
							var vm = this;
							window.EventBus.$on('data', function (data) {
								vm.record = data;
							});
						},
						changeValid() {
							let vm = this;
							if (vm.formValid) vm.formValid.destroy();
							//form
							var formHandle = vm.$refs["contact-form"];
							var formOption = {
								locale: record.locale || "en",
								// set a incorrect message text
								messages: {
									vi: {
										required: {
											empty: "Vui lòng không để trống",
											incorrect: "Giá trị bị sai"
										},
										name: {
											empty: "Vui lòng nhập tên của bạn",
											incorrect: "Tên bị sai"
										},
										email: {
											empty: "Vui lòng nhập email của bạn",
											incorrect: "Giá trị email bị sai"
										},
										url: {
											empty: "Vui lòng nhập url của bạn",
											incorrect: "Giá trị url bị sai (vd: https://domain.xyz)"
										},
										length: {
											empty: "Vui lòng nhập tối thiểu {0} ký tự và tối đa là {1}",
											incorrect: "Sai! Nhập tối thiểu {0} ký tự và tối đa là {1}"
										},
										minlength: {
											empty: "Vui lòng nhập ít nhất {0} ký tự",
											incorrect: "Bạn đã nhập ít hơn {0} ký tự"
										}
									}
								}
							};
							// Got to validation
							vm.formValid = new Validator(
								formHandle,
								function (err, res) {
									document.getElementById("submit-info").disabled = true;
									// some code of success of validation
									console.log('success')
									return false;
								},
								formOption
							);
						}
					},
				});
			}
		</script>
</body>

</html>